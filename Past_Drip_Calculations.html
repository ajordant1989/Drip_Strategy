<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Past DRIP Calculations</title>
    <link rel="stylesheet" href="global.css">
</head>

<body>
    <nav class="sticky-nav bespoke-nav">
        <div class="nav-content"
            style="max-width:1280px; margin:0 auto; width:100%; display:flex; align-items:center; justify-content:space-between;">
            <div class="nav-left">
                <img src="images/bespoke-white.svg" alt="Bespoke Financial Logo" class="bespoke-logo">
            </div>
            <div class="nav-right">
                <a class="nav-link" href="Drip_Strategy.html">DRIP Calculator</a>
            </div>
        </div>
    </nav>
    <div class="container" style="margin-top:80px; display:flex; flex-direction:column; align-items:center;">
        <h1 style="margin-bottom:32px;">Past DRIP Calculations</h1>
        <div id="savedViewsList" style="width:100%; max-width:1280px;"></div>
    </div>
    <script>
        function loadSavedViews() {
            const listDiv = document.getElementById('savedViewsList');
            const saved = JSON.parse(localStorage.getItem('dripSavedViews') || '[]');
            if (saved.length === 0) {
                listDiv.innerHTML = '<p>No saved views yet.</p>';
                return;
            }
            let tableHTML = `<table class="portfolio-table" style="width:100%; max-width:1280px; margin-top:24px;">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Date Saved</th>
                        <th>Positions</th>
                        <th>Total Investment</th>
                        <th>Target Amount</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>`;
            saved.forEach((view, idx) => {
                let posCount = Array.isArray(view.data.positions) ? view.data.positions.length : 0;
                let totalInvestment = view.data.totalInvestment ? `$${Number(view.data.totalInvestment).toLocaleString('en-US')}` : '-';
                let targetAmount = view.data.targetAmount ? `$${Number(view.data.targetAmount).toLocaleString('en-US')}` : '-';
                tableHTML += `<tr>
                    <td>${view.name}</td>
                    <td>${view.date}</td>
                    <td>${posCount}</td>
                    <td>${totalInvestment}</td>
                    <td>${targetAmount}</td>
                    <td>
                        <button onclick="openView(${idx})" class="btn-gold" style="margin-bottom:10px;">Open</button>
                        <button onclick="deleteView(${idx})" class="remove-btn">Delete</button>
                    </td>
                </tr>`;
            });
            tableHTML += '</tbody></table>';
            listDiv.innerHTML = tableHTML;
        }
        function openView(idx) {
            const saved = JSON.parse(localStorage.getItem('dripSavedViews') || '[]');
            if (!saved[idx]) return;
            localStorage.setItem('dripStrategyState', JSON.stringify(saved[idx].data));
            window.location.href = 'Drip_Strategy.html';
        }
        function deleteView(idx) {
            let saved = JSON.parse(localStorage.getItem('dripSavedViews') || '[]');
            saved.splice(idx, 1);
            localStorage.setItem('dripSavedViews', JSON.stringify(saved));
            loadSavedViews();
        }
        document.addEventListener('DOMContentLoaded', loadSavedViews);
    </script>
</body>

</html>