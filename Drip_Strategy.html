<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRIP Strategy Calculator & Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Modern STRIKE-inspired style update --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: transparent;
            box-shadow: none;
            border-radius: 0;
            max-width: 480px;
            width: 100%;
            margin: 0 auto;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        h1 {
            color: #fff;
            font-size: 2.2rem;
            font-weight: 700;
            margin-top: 48px;
            margin-bottom: 32px;
            text-align: center;
            letter-spacing: 0.01em;
        }

        .desc {
            color: #b3b3b3;
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 32px;
        }

        .card, .full-width {
            background: #111;
            border-radius: 18px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.15);
            padding: 32px 24px 24px 24px;
            margin-bottom: 32px;
            width: 100%;
            max-width: 420px;
        }
        
        .card h2 {
            color: #fff;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 18px;
        }
        
        .main-content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .full-width {
            grid-column: 1 / -1;
        }
        
        .input-group, .input-full {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        label {
            color: #b3b3b3;
            font-size: 1rem;
            margin-bottom: 4px;
        }
        
        input, select {
            background: #222;
            color: #fff;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 12px;
            font-size: 1rem;
            margin-bottom: 0;
            transition: border-color 0.2s;
        }
        input:focus, select:focus {
            border-color: #fff;
            outline: none;
        }
        
        .btn {
            background: #fff;
            color: #000;
            border: none;
            border-radius: 10px;
            padding: 14px 0;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            margin-bottom: 0;
            width: 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: background 0.2s, color 0.2s;
        }
        .btn:hover {
            background: #f2f2f2;
            color: #222;
        }

        .button-group {
            display: flex;
            gap: 16px;
            margin-top: 24px;
            justify-content: center;
        }
        
        .portfolio-table, .projection-table {
            background: #111;
            color: #fff;
            border-radius: 12px;
            width: 100%;
            margin: 16px 0;
            font-size: 0.95rem;
            border-collapse: separate;
            border-spacing: 0;
        }
        .portfolio-table th, .projection-table th {
            background: #222;
            color: #fff;
            font-weight: 600;
            padding: 12px;
            border-bottom: 1px solid #222;
        }
        .portfolio-table td, .projection-table td {
            padding: 12px;
            border-bottom: 1px solid #222;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 32px 0;
        }
        
        .result-card {
            background: #111;
            color: #fff;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            margin-bottom: 16px;
        }
        .result-card h3 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: #b3b3b3;
        }
        .result-card .value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .projection-chart {
            background: #252F31;
            border-radius: 8px;
            padding: 20px;
            margin-top: 24px;
        }
        
        .highlight {
            background: #F5A623;
            color: #1C2526;
            font-weight: 600;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #252F31;
            padding: 20px;
            border-radius: 8px;
            width: 360px;
            max-width: 90%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .modal-content h3 {
            margin-bottom: 12px;
            color: #F5A623;
        }
        
        .close-btn {
            background: #EF4444;
            color: #FFFFFF;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 8px;
        }
        
        .close-btn:hover {
            background: #DC2626;
        }
        
        .error-message {
            color: #EF4444;
            font-size: 0.85rem;
            margin-top: 8px;
            text-align: center;
        }
        
        .remove-btn {
            background: #EF4444;
            color: #FFFFFF;
            border: none;
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .remove-btn:hover {
            background: #DC2626;
        }
        
        /* Floating Bitcoin icons */
        .btc-float {
            position: absolute;
            width: 60px;
            height: 60px;
            z-index: 10;
            animation: btcFloat 4s infinite ease-in-out alternate;
        }
        .btc-float.btc1 { left: 10%; top: 20%; animation-delay: 0s; }
        .btc-float.btc2 { right: 10%; top: 30%; animation-delay: 1s; }
        @keyframes btcFloat {
            0% { transform: translateY(0) rotate(-10deg); }
            100% { transform: translateY(30px) rotate(10deg); }
        }

        @media (max-width: 600px) {
            .container, .card, .full-width {
                max-width: 98vw;
                padding: 16px;
            }
            h1 {
                font-size: 1.3rem;
                margin-top: 24px;
                margin-bottom: 24px;
            }
            .card, .full-width {
                padding: 20px 8px 16px 8px;
                margin-bottom: 20px;
            }
            .results {
                gap: 12px;
                margin: 20px 0;
            }
        }
        /* --- End STRIKE-inspired style update --- */
    </style>
</head>
<body>
    <div class="container">
        <h1>DRIP Strategy Calculator & Tracker</h1>
        
        <div class="main-content-grid">
            <div class="card">
                <h2>ðŸ“Š Portfolio Setup</h2>
                <div class="input-group">
                    <div>
                        <label for="totalInvestment">Total Investment Amount ($)</label>
                        <input type="number" id="totalInvestment" value="0" step="100" min="0">
                    </div>
                    <div>
                        <label for="targetAmount">Target Amount ($)</label>
                        <input type="number" id="targetAmount" value="0" step="100" min="0">
                    </div>
                </div>
                <div class="input-full">
                    <label for="distributionFreq">Distribution Frequency</label>
                    <select id="distributionFreq">
                        <option value="52">Weekly (52x/year)</option>
                        <option value="26">Bi-weekly (26x/year)</option>
                        <option value="12" selected>Monthly (12x/year)</option>
                        <option value="4">Quarterly (4x/year)</option>
                    </select>
                </div>
            </div>
            
            <div class="card">
                <h2>ðŸ’° IUL Integration</h2>
                <div class="input-group">
                    <div>
                        <label for="iulPremium">Monthly IUL Premium ($)</label>
                        <input type="number" id="iulPremium" value="0" step="50" min="0">
                    </div>
                    <div>
                        <label for="iulCashValue">Current Cash Value ($)</label>
                        <input type="number" id="iulCashValue" value="0" step="100" min="0">
                    </div>
                </div>
                <div class="input-group">
                    <div>
                        <label for="iulGrowthRate">Expected Growth Rate (%)</label>
                        <input type="number" id="iulGrowthRate" value="0" step="0.5" min="0">
                    </div>
                    <div>
                        <label for="reinvestToIUL">Reinvest % to IUL</label>
                        <input type="number" id="reinvestToIUL" value="0" step="5" min="0" max="100">
                    </div>
                </div>
            </div>

            <div class="card full-width">
                <h2>â‚¿ Bitcoin Integration</h2>
                <div class="input-group">
                    <div>
                        <label for="bitcoinAmountBTC">Current Bitcoin Amount (BTC)</label>
                        <input type="number" id="bitcoinAmountBTC" value="0" step="0.001" min="0">
                    </div>
                    <div>
                        <label for="bitcoinPriceUSD">Bitcoin Price (USD/BTC)</label>
                        <input type="number" id="bitcoinPriceUSD" value="0" step="100" min="0">
                    </div>
                    <div>
                        <label for="bitcoinCAGR">Bitcoin CAGR (%)</label>
                        <input type="number" id="bitcoinCAGR" value="0" step="0.5" min="0">
                    </div>
                    <div>
                        <label for="bitcoinMonthlySavingsUSD">Monthly Bitcoin Savings ($)</label>
                        <input type="number" id="bitcoinMonthlySavingsUSD" value="0" step="1" min="0">
                    </div>
                    <div>
                        <label for="reinvestToBitcoin">Reinvest % to Bitcoin</label>
                        <input type="number" id="reinvestToBitcoin" value="0" step="5" min="0" max="100">
                    </div>
                </div>
            </div>
        
            <div class="card full-width">
                <h2>ðŸ“ˆ Portfolio Positions</h2>
                <div id="allocationError" class="error-message" style="display: none;"></div>
                <table class="portfolio-table" id="portfolioTable">
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Allocation %</th>
                            <th>Amount ($)</th>
                            <th>Yield %</th>
                            <th>Annual Income</th>
                            <th>Weekly Income</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="portfolioBody">
                        </tbody>
                </table>
                <div class="button-group">
                    <button class="btn" onclick="openAddPositionModal()">+ Add New Position</button>
                    <button class="btn" onclick="calculateResults()">ðŸš€ Calculate Strategy</button>
                </div>
            </div>
        </div>
        
        <div class="results" id="results" style="display: none;">
            <div class="result-card">
                <h3>Blended Yield</h3>
                <div class="value" id="blendedYield">0%</div>
            </div>
            <div class="result-card">
                <h3>Weekly Income</h3>
                <div class="value" id="weeklyIncome">$0</div>
            </div>
            <div class="result-card">
                <h3>Annual Income</h3>
                <div class="value" id="annualIncome">$0</div>
            </div>
            <div class="result-card">
                <h3>Time to Target</h3>
                <div class="value" id="timeToTarget">0 months</div>
            </div>
        </div>
        
        <div class="projection-chart" id="projectionChartContainer" style="display: none; height: 500px;">
            <h2>ðŸ“Š Monthly Growth Projection</h2>
            <canvas id="wealthChart" style="margin-bottom: 16px; height: 400px;"></canvas>
            <table class="projection-table" id="projectionTable">
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>Portfolio Value</th>
                        <th>Monthly Income</th>
                        <th>IUL Value</th>
                        <th>Bitcoin Value</th>
                        <th>Total Wealth</th>
                    </tr>
                </thead>
                <tbody id="projectionBody">
                    </tbody>
            </table>
        </div>
    </div>

    <div class="modal" id="addPositionModal">
        <div class="modal-content">
            <h3>Add New Position</h3>
            <div class="input-group">
                <div>
                    <label for="modalTicker">Ticker Symbol</label>
                    <input type="text" id="modalTicker" placeholder="e.g., AAPL">
                </div>
                <div>
                    <label for="modalAllocation">Allocation (%)</label>
                    <input type="number" id="modalAllocation" step="0.1" min="0" placeholder="e.g., 25">
                </div>
                <div>
                    <label for="modalYield">Yield (%)</label>
                    <input type="number" id="modalYield" step="0.1" min="0" placeholder="e.g., 5">
                </div>
            </div>
            <div id="modalError" class="error-message" style="display: none;"></div>
            <button class="btn" onclick="submitNewPosition()">Add Position</button>
            <button class="close-btn" onclick="closeAddPositionModal()">Cancel</button>
        </div>
    </div>

    <script>
        let positions = [];
        let positionCounter = 0;
        let wealthChart = null;

        // Initialize with no default positions
        function initializeDefaultPositions() {
            positions = [];
            positionCounter = 0;
            updatePortfolioDisplay();
        }

        function addPositionToArray(ticker, allocation, yieldRate) {
            positions.push({
                id: positionCounter++,
                ticker: ticker,
                allocation: allocation,
                yield: yieldRate
            });
        }

        function openAddPositionModal() {
            document.getElementById('addPositionModal').style.display = 'flex';
            document.getElementById('modalTicker').value = '';
            document.getElementById('modalAllocation').value = '';
            document.getElementById('modalYield').value = '';
            document.getElementById('modalError').style.display = 'none';
        }

        function closeAddPositionModal() {
            document.getElementById('addPositionModal').style.display = 'none';
        }

        function submitNewPosition() {
            const ticker = document.getElementById('modalTicker').value.trim().toUpperCase();
            const allocation = parseFloat(document.getElementById('modalAllocation').value);
            const yieldRate = parseFloat(document.getElementById('modalYield').value);
            
            if (!ticker || isNaN(allocation) || isNaN(yieldRate) || allocation <= 0 || yieldRate < 0) {
                document.getElementById('modalError').textContent = 'Please enter valid values for all fields.';
                document.getElementById('modalError').style.display = 'block';
                return;
            }

            const totalAllocation = positions.reduce((sum, pos) => sum + pos.allocation, 0) + allocation;
            if (totalAllocation > 100) {
                document.getElementById('modalError').textContent = 'Total allocation exceeds 100%.';
                document.getElementById('modalError').style.display = 'block';
                return;
            }

            addPositionToArray(ticker, allocation, yieldRate);
            updatePortfolioDisplay();
            closeAddPositionModal();
        }

        function removePosition(id) {
            positions = positions.filter(pos => pos.id !== id);
            updatePortfolioDisplay();
        }

        function updatePosition(id, field, value) {
            const position = positions.find(pos => pos.id === id);
            if (position) {
                if (field === 'ticker') {
                    position[field] = value.toUpperCase();
                } else {
                    position[field] = parseFloat(value) || 0;
                }
                updatePortfolioDisplay();
            }
        }

        function updatePortfolioDisplay() {
            const tbody = document.getElementById('portfolioBody');
            const totalInvestment = parseFloat(document.getElementById('totalInvestment').value) || 0;
            const totalAllocation = positions.reduce((sum, pos) => sum + pos.allocation, 0);
            
            const allocationError = document.getElementById('allocationError');
            if (totalAllocation > 100) {
                allocationError.textContent = `Total allocation (${totalAllocation.toFixed(1)}%) exceeds 100%. Please adjust.`;
                allocationError.style.display = 'block';
            } else {
                allocationError.style.display = 'none';
            }

            tbody.innerHTML = '';
            
            positions.forEach(position => {
                const amount = (totalInvestment * position.allocation / 100);
                const annualIncome = (amount * position.yield / 100);
                const weeklyIncome = (annualIncome / 52);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <input type="text" value="${position.ticker}" 
                               onchange="updatePosition(${position.id}, 'ticker', this.value)"
                               style="border: none; background: transparent; color: #E5E7EB; font-weight: 600; width: 80px;">
                    </td>
                    <td>
                        <input type="number" value="${position.allocation}" 
                               onchange="updatePosition(${position.id}, 'allocation', this.value)"
                               style="border: none; background: transparent; color: #E5E7EB; width: 60px;" min="0">%
                    </td>
                    <td>$${amount.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                    <td>
                        <input type="number" value="${position.yield}" 
                               onchange="updatePosition(${position.id}, 'yield', this.value)"
                               style="border: none; background: transparent; color: #E5E7EB; width: 60px;" min="0">%
                    </td>
                    <td>$${annualIncome.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                    <td>$${weeklyIncome.toLocaleString('en-US', {maximumFractionDigits: 2})}</td>
                    <td>
                        <button class="remove-btn" onclick="removePosition(${position.id})">Remove</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function calculateResults() {
            const totalInvestment = parseFloat(document.getElementById('totalInvestment').value) || 0;
            const targetAmount = parseFloat(document.getElementById('targetAmount').value) || 0;
            const reinvestToIUL = parseFloat(document.getElementById('reinvestToIUL').value) || 0;
            const reinvestToBitcoin = parseFloat(document.getElementById('reinvestToBitcoin').value) || 0;

            if (totalInvestment <= 0 || targetAmount <= 0) {
                alert('Total Investment and Target Amount must be greater than 0.');
                return;
            }
            if (positions.length === 0) {
                alert('Please add at least one position.');
                return;
            }
            const totalAllocation = positions.reduce((sum, pos) => sum + pos.allocation, 0);
            if (totalAllocation > 100) {
                alert('Total allocation exceeds 100%. Please adjust.');
                return;
            }
             if (reinvestToIUL + reinvestToBitcoin > 100) {
                alert('The sum of reinvestment percentages for IUL and Bitcoin cannot exceed 100%.');
                return;
            }

            let totalWeightedYield = 0;
            positions.forEach(position => {
                totalWeightedYield += position.allocation * position.yield;
            });
            
            const blendedYield = totalAllocation > 0 ? totalWeightedYield / totalAllocation : 0;
            const annualIncome = totalInvestment * blendedYield / 100;
            const weeklyIncome = annualIncome / 52;
            
            const projectionResults = generateAndRenderProjections();
            
            document.getElementById('blendedYield').textContent = blendedYield.toFixed(2) + '%';
            document.getElementById('weeklyIncome').textContent = '$' + weeklyIncome.toLocaleString('en-US', {maximumFractionDigits: 2});
            document.getElementById('annualIncome').textContent = '$' + annualIncome.toLocaleString('en-US', {maximumFractionDigits: 0});
            document.getElementById('timeToTarget').textContent = projectionResults.timeToTarget !== 'N/A' ? `${projectionResults.timeToTarget} months` : 'N/A';
            
            document.getElementById('results').style.display = 'grid';
            document.getElementById('projectionChartContainer').style.display = 'block';

            renderChart(projectionResults.chartData);
        }

        function generateAndRenderProjections() {
            const totalInvestment = parseFloat(document.getElementById('totalInvestment').value) || 0;
            const targetAmount = parseFloat(document.getElementById('targetAmount').value) || 0;
            const iulPremium = parseFloat(document.getElementById('iulPremium').value) || 0;
            const iulCashValue = parseFloat(document.getElementById('iulCashValue').value) || 0;
            const iulGrowthRate = parseFloat(document.getElementById('iulGrowthRate').value) || 0;
            const reinvestToIUL = parseFloat(document.getElementById('reinvestToIUL').value) || 0;
            const bitcoinAmountBTC = parseFloat(document.getElementById('bitcoinAmountBTC').value) || 0;
            const initialBitcoinPriceUSD = parseFloat(document.getElementById('bitcoinPriceUSD').value) || 60000;
            const bitcoinCAGR = parseFloat(document.getElementById('bitcoinCAGR').value) || 0;
            const bitcoinMonthlySavingsUSD = parseFloat(document.getElementById('bitcoinMonthlySavingsUSD').value) || 0;
            const reinvestToBitcoin = parseFloat(document.getElementById('reinvestToBitcoin').value) || 0;

            let totalWeightedYield = 0;
            const totalAllocation = positions.reduce((sum, pos) => sum + pos.allocation, 0);
            positions.forEach(position => {
                totalWeightedYield += position.allocation * position.yield;
            });
            const blendedYield = totalAllocation > 0 ? totalWeightedYield / totalAllocation : 0;

            const monthlyYield = blendedYield / 100 / 12;
            const monthlyIULGrowth = iulGrowthRate / 100 / 12;
            const monthlyBitcoinGrowth = Math.pow(1 + bitcoinCAGR / 100, 1 / 12) - 1;
            
            let portfolioValue = totalInvestment;
            let currentIULValue = iulCashValue;
            let currentBitcoinAmountBTC = bitcoinAmountBTC;
            let currentBitcoinPriceUSD = initialBitcoinPriceUSD;
            
            const tbody = document.getElementById('projectionBody');
            tbody.innerHTML = '';
            
            const chartData = { labels: [], portfolio: [], iul: [], bitcoin: [], total: [] };
            let timeToTarget = 'N/A';
            let targetReached = false;

            for (let month = 0; month <= 600; month++) { // Calculate for up to 50 years
                const monthlyIncome = portfolioValue * monthlyYield;
                const toIUL = monthlyIncome * (reinvestToIUL / 100);
                const toBitcoin = monthlyIncome * (reinvestToBitcoin / 100);
                const toDRIP = monthlyIncome - toIUL - toBitcoin;
                
                if (month > 0) {
                    portfolioValue += toDRIP;
                    
                    currentIULValue += toIUL + iulPremium;
                    currentIULValue *= (1 + monthlyIULGrowth);
                    
                    const btcFromSavings = bitcoinMonthlySavingsUSD / currentBitcoinPriceUSD;
                    const btcFromReinvest = toBitcoin / currentBitcoinPriceUSD;
                    currentBitcoinAmountBTC += btcFromSavings + btcFromReinvest;
                    
                    currentBitcoinPriceUSD *= (1 + monthlyBitcoinGrowth);
                }
                
                const currentBitcoinValueUSD = currentBitcoinAmountBTC * currentBitcoinPriceUSD;
                const totalWealth = portfolioValue + currentIULValue + currentBitcoinValueUSD;
                
                if (totalWealth >= targetAmount && timeToTarget === 'N/A') {
                    timeToTarget = month;
                    targetReached = true;
                }
                
                // Only render up to 48 months in the monthly table
                if (month <= 48) {
                    const row = document.createElement('tr');
                    if (month === timeToTarget) {
                        row.className = 'highlight';
                    }
                    row.innerHTML = `
                        <td>${month}</td>
                        <td>$${portfolioValue.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                        <td>$${monthlyIncome.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                        <td>$${currentIULValue.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                        <td>$${currentBitcoinValueUSD.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                        <td>$${totalWealth.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                    `;
                    tbody.appendChild(row);
                }

                chartData.labels.push(`Month ${month}`);
                chartData.portfolio.push(portfolioValue);
                chartData.iul.push(currentIULValue);
                chartData.bitcoin.push(currentBitcoinValueUSD);
                chartData.total.push(totalWealth);

                // Stop charting data after 5 years unless target hasn't been hit
                if (month > 60 && targetReached) {
                    break;
                }
            }
            
            // After the monthly table, render a 5-year annual projection table
            const annualTable = document.createElement('table');
            annualTable.className = 'projection-table';
            annualTable.innerHTML = `
                <thead>
                    <tr>
                        <th>Year</th>
                        <th>Portfolio Value</th>
                        <th>Annual Income</th>
                        <th>IUL Value</th>
                        <th>Bitcoin Value</th>
                        <th>Total Wealth</th>
                    </tr>
                </thead>
                <tbody id="annualProjectionBody"></tbody>
            `;
            document.getElementById('projectionChartContainer').appendChild(annualTable);
            const annualTbody = document.getElementById('annualProjectionBody');
            for (let year = 1; year <= 5; year++) {
                // Calculate values at the end of each year
                const monthIdx = year * 12;
                if (chartData.portfolio[monthIdx] !== undefined) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${year}</td>
                        <td>$${chartData.portfolio[monthIdx].toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                        <td>$${(chartData.portfolio[monthIdx] * blendedYield / 100).toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                        <td>$${chartData.iul[monthIdx].toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                        <td>$${chartData.bitcoin[monthIdx].toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                        <td>$${chartData.total[monthIdx].toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                    `;
                    annualTbody.appendChild(row);
                }
            }
            
            return { timeToTarget, chartData };
        }

        function renderChart(chartData) {
            if (wealthChart) {
                wealthChart.destroy();
            }
            
            const ctx = document.getElementById('wealthChart').getContext('2d');
            wealthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [
                        {
                            label: 'Portfolio Value',
                            data: chartData.portfolio,
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: false,
                            tension: 0.1
                        },
                        {
                            label: 'IUL Cash Value',
                            data: chartData.iul,
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: false,
                            tension: 0.1
                        },
                        {
                            label: 'Bitcoin Value (USD)',
                            data: chartData.bitcoin,
                            borderColor: '#8B5CF6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            fill: false,
                            tension: 0.1
                        },
                        {
                            label: 'Total Wealth',
                            data: chartData.total,
                            borderColor: '#F5A623',
                            backgroundColor: 'rgba(245, 166, 35, 0.1)',
                            fill: false,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Value ($)', color: '#E5E7EB' },
                            ticks: { 
                                color: '#E5E7EB',
                                callback: function(value) {
                                    return '$' + Number(value).toLocaleString();
                                }
                            },
                            grid: { color: 'rgba(75, 85, 99, 0.3)' }
                        },
                        x: {
                            title: { display: true, text: 'Time Period', color: '#E5E7EB' },
                            ticks: { color: '#E5E7EB' },
                            grid: { color: 'rgba(75, 85, 99, 0.3)' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#E5E7EB' } }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeDefaultPositions();
            document.getElementById('totalInvestment').addEventListener('input', updatePortfolioDisplay);
            document.getElementById('targetAmount').addEventListener('input', updatePortfolioDisplay);
            document.getElementById('distributionFreq').addEventListener('change', updatePortfolioDisplay);
            document.getElementById('iulPremium').addEventListener('input', updatePortfolioDisplay);
            document.getElementById('iulCashValue').addEventListener('input', updatePortfolioDisplay);
            document.getElementById('iulGrowthRate').addEventListener('input', updatePortfolioDisplay);
            document.getElementById('reinvestToIUL').addEventListener('input', updatePortfolioDisplay);
            document.getElementById('bitcoinAmountBTC').addEventListener('input', updatePortfolioDisplay);
            document.getElementById('bitcoinPriceUSD').addEventListener('input', updatePortfolioDisplay);
            document.getElementById('bitcoinCAGR').addEventListener('input', updatePortfolioDisplay);
            document.getElementById('bitcoinMonthlySavingsUSD').addEventListener('input', updatePortfolioDisplay);
            document.getElementById('reinvestToBitcoin').addEventListener('input', updatePortfolioDisplay);
        });
    </script>
</body>
</html>